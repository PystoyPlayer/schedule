<!DOCTYPE html>
<html lang="ru">
<head>
    <title>График</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta charset="utf-8">
    <meta name="description" content="Расписание серий в Telegram канале @SubVost">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">
    <link rel="mask-icon" href="favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="icon" href="favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="favicon/browserconfig.xml">
    <meta name="theme-color" content="#181818">
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
            line-height: 1.5;
            background-color: #181818;
            background-size: cover;
            color: #d1d1d1;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: default;
            user-select: none;
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }
        div {
            max-width: 620px;
        }
        h1 {
            text-align: center;
            margin-top: 5px;
            font-size: 36px;
            color: #ffffff;
        }
        h2 {
            font-size: 24px;
            margin-bottom: 5px;
            margin-top: 25px;
            color: #dddddd;
        }
        ul {
            padding-left: 0;
            margin-top: 0;
            margin-bottom: 7px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        li {
            margin-bottom: 5px;
            color: #dddddd;
        }
        .schedule-item {
            display: flex;
            align-items: baseline;
            cursor: default;
            transition: background-color 0.3s ease-in-out;
            margin-bottom: 5px;
            width: 100%;
            padding-left: 15px;
            box-sizing: border-box;
            border-radius: 5px;
        }
        .schedule-item .title {
            font-size: 16px;
            margin-left: 5px;
            padding-right: 15px;
            overflow: hidden;
            min-height: 1.5em;
            transition: opacity 0.5s ease-in-out, max-height 0.5s ease-in-out;
            line-height: 1.5em;
        }
        .empty-day {
            color: #ffffff;
        }
        .empty-item {
            pointer-events: none;
            opacity: 0.5;
        }
        .empty-item:hover {
            background-color: transparent;
        }
        .schedule-item:not(.empty-item):hover {
            background-color: rgba(170, 170, 170, 0.3);
            cursor: pointer;
        }
        .title:hover {
            background-color: transparent;
        }
        .time {
            position: relative;
            display: inline-block;
            margin-right: 5px;
            padding: 0px 5px;
            border-radius: 6px;
            background-color: rgba(170, 170, 170, 0.3);
            color: #dddddd;
            border: 1.5px solid transparent;
        }
        @keyframes blinking {
          0%, 100% { border-color: transparent; }
          50% { border-color: white; }
        }
        .time.highlighted {
          animation: blinking 1.5s infinite;
        }
        .highlighted-item {
            background-color: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div>
        <h1>График выхода серий (GMT+3)</h1>
        <script>
            const days = [
                {day: 'Понедельник', schedule: [
                    { time: '17:15', title: 'Миги и Дали' },
                    { time: '17:45', title: 'Рон Камонохаши: невменяемый детектив' },
                    { time: '19:15', title: 'Стесняшка' },
                    { time: '19:45', title: 'Я предпочитаю злодейку' },
                    { time: '20:15', title: 'Обычный мужчина средних лет и его журнал активности в VRMMO [4K]' }
                ]},
                { day: 'Вторник', schedule: [
                    { time: '17:15', title: 'Всемогущая магия святой 2' }
                ]},
                {day: 'Среда', schedule: [
                    { time: '16:15', title: 'Прибрал к рукам девушку, потерявшую жениха, и теперь учу её всяким плохим вещам' },
                    { time: '22:00', title: 'Восхождение в тени 2 [4K]' }
                ]},
                {day: 'Четверг', schedule: [
                    { time: '17:15', title: 'Моя дочь, отправившаяся в столицу, захотев стать авантюристом, достигла S-ранга' },
                    { time: '18:15', title: 'Невеста чародея 2. Часть 2' },
                    { time: '19:42', title: 'Низкоквалифицированный ниндзя' },
                    { time: '19:50', title: 'Мой телохранитель' },
                    { time: '22:20', title: 'Магическая битва 2' },
                    { time: '23:15', title: 'Бродяга Кэнсин' }
                ]},
                { day: 'Пятница', schedule: [
                    { time: '14:00', title: 'Восхождение героя щита 3' },
                    { time: '16:30', title: 'Убийца гоблинов 2' },
                    { time: '18:15', title: 'Фрирен, провожающая в последний путь' },
                    { time: '19:40', title: 'Аркнайтс: Зимнее уединение' },
                    { time: '20:15', title: 'Королевство руин' },
                    { time: '20:45', title: 'Мои девушки 2' }
                ]},
                { day: 'Суббота', schedule: [
                    { time: '12:15', title: 'Дайго из пожарной команды' },
                    { time: '16:15', title: 'Далёкий паладин 2' },
                    { time: '17:15', title: 'Семья шпиона 2' },
                    { time: '17:45', title: 'Мой новый босс глупый' },
                    { time: '18:45', title: 'Не ешь сырую свинину' },
                    { time: '19:15', title: 'История империи Тиамун' },
                    { time: '19:45', title: 'Наш дождливый протокол' },
                    { time: '20:15', title: 'Я выживу с помощью зелий!' }
                ]},
                { day: 'Воскресенье', schedule: [
                    { time: '12:15', title: 'Рубеж Шангри-Ла: Любитель игрошлака бросает вызов топ-игре' },
                    { time: '17:43', title: 'Обгон!' },
                    { time: '17:50', title: 'Семейная жизнь легкомысленной ведьмы' },
                    { time: '18:45', title: 'Ненасытный Берсерк' },
                    { time: '20:15', title: 'MF Призрак' }
                ]},
                { day: 'Без графика', schedule: [
                    { title: 'Мой счастливый брак (лето) Мой счастливый брак (лето) Мой счастливый брак (лето) Мой счастливый брак (лето) Nfnsnsfmg dfgmdfgmdgfmgdfjgkjdfkjgkdfkgk' },
                    { title: 'Test' },
                ]}];

            // Получение текущего времени и дня
            const currentDay = new Date().getDay();
            const currentTime = new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });

            // Обновление времени в расписании с учетом часового пояса
            function adjustScheduleTime(days, diff) {
              days.forEach(day => {
                day.schedule.forEach(info => {
                  if (!info.time) return;

                  const [hours, minutes] = info.time.split(':').map(Number);
                  let date = new Date();
                  date.setHours(hours, minutes - diff);
                  
                  if (date.getDate() !== new Date().getDate()) {
                    moveToShowToAnotherDay(day, date.getHours() < 0 ? -1 : 1);
                  }
                  
                  info.time = date.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });
                });
              });
            }

            function moveToShowToAnotherDay(day, offset) {
              const dayIndex = (days.indexOf(day) + offset + 7) % 7;
              days[dayIndex].schedule.push(...day.schedule);
              day.schedule = [];
            }

            // Подсветка ближайшего будущего релиза
            function highlightNextShow(days, currentDayIndex, currentTime) {
              let foundNextShow = false;
              days[currentDayIndex].schedule = days[currentDayIndex].schedule.map(show => {
                if (foundNextShow) return show; // Если уже нашли следующий релиз, ничего не делаем
                if (isTimeLater(show.time, currentTime)) { // Проверяем, если время шоу позже текущего времени
                  show.highlighted = true; // Выделяем его
                  foundNextShow = true; // Запоминаем, что нашли следующий релиз
                }
                return show;
              });
            }

            function isTimeLater(time1, time2) {
              const [hours1, minutes1] = time1.split(':').map(Number);
              const [hours2, minutes2] = time2.split(':').map(Number);
              return hours1 > hours2 || (hours1 === hours2 && minutes1 > minutes2);
            }

            // Отображение расписания
            function renderDaySchedule() {
              days.forEach(day => {
                document.writeln(`<h2>${day.day}:</h2>`);
                const listItems = day.schedule.map(createScheduleItem).join('');
                document.writeln(`<ul>${listItems}</ul>`);
              });
              setInitialMaxHeight();
            }

            function createScheduleItem(info) {
              const timeCode = info.time ? `<span class="time ${info.highlighted ? 'highlighted' : ''}">${info.time}</span>` : '';
              const title = `<span class="title">${info.title}</span>`;
              return `<div class="schedule-item" onclick="copyText(this, '${info.time} - ${info.title}')">${timeCode}${title}</div>`;
            }

            let isAnimationInProgress = false;

            function copyText(element, textToCopy) {
                if (isAnimationInProgress) {
                    console.log('Animation in progress, copy blocked.');
                    return; // Выходим из функции, если идет анимация
                }

                const clipboardText = textToCopy.trim();
                if (!clipboardText) {
                    console.log('No text to copy.');
                    return;
                }

                // Использование нового API для копирования текста
                navigator.clipboard.writeText(clipboardText).then(function() {
                    console.log('Text copied to clipboard:', clipboardText);
                    replaceTitleWithCopied(element);
                }).catch(function(error) {
                    console.error('Error copying text: ', error);
                });
                highlightItem(element);
            }

            function replaceTitleWithCopied(element) {
                const titleElement = element.querySelector('.title');
                const originalTitle = titleElement.textContent.trim();
                const animationDuration = 500;
                const originalMaxHeight = titleElement.scrollHeight + "px"; // Получите текущую высоту содержимого

                titleElement.style.maxHeight = originalMaxHeight; // Установите начальное значение max-height

                isAnimationInProgress = true; // Устанавливаем флаг, что анимация началась

                titleElement.style.transition = `opacity ${animationDuration / 1000}s ease-in-out, max-height ${animationDuration / 1000}s ease-in-out`;
                changeTitleText(titleElement, 'Скопировано', animationDuration, originalTitle, originalMaxHeight);
            }

            function changeTitleText(titleElement, newText, duration, originalText, originalMaxHeight) {
                titleElement.style.opacity = 0;
                titleElement.style.maxHeight = "1em"; // Высота одной строки текста

                setTimeout(() => {
                    titleElement.textContent = newText;
                    titleElement.style.opacity = 1;
                    titleElement.style.maxHeight = originalMaxHeight; // Возвращаем к исходной высоте

                    setTimeout(() => {
                        titleElement.style.opacity = 0;
                        titleElement.style.maxHeight = "1em"; // Снова сузим до одной строки

                        setTimeout(() => {
                            titleElement.textContent = originalText;
                            titleElement.style.opacity = 1;
                            titleElement.style.maxHeight = originalMaxHeight; // Восстановите исходное значение

                            isAnimationInProgress = false; // Снимаем флаг, анимация закончена
                        }, duration);
                    }, duration * 2);
                }, duration);
            }

            function highlightItem(item) {
                item.classList.add("highlighted-item");
                setTimeout(() => {
                    item.classList.remove("highlighted-item");
                }, 3000); // подсветка исчезнет через 3 секунды
            }
            function setInitialMaxHeight() {
                const titles = document.querySelectorAll('.schedule-item .title');
                titles.forEach(title => {
                    title.style.maxHeight = title.scrollHeight + "px";
                });
            }

            function clearHighlights() {
                document.querySelectorAll('.highlighted-item').forEach(el => {
                    el.classList.remove('highlighted-item');
                });
            }

            document.addEventListener('click', clearHighlights);
            window.addEventListener('scroll', clearHighlights, true);
            window.addEventListener('touchmove', clearHighlights, true); // Обработка прокрутки на мобильных устройствах

            const moscowTimeZoneOffset = -180; // Московское время GMT+3
            const userTimeZoneOffset = new Date().getTimezoneOffset(); // Смещение часового пояса пользователя в минутах
            const differenceInMinutes = moscowTimeZoneOffset - userTimeZoneOffset;
            adjustScheduleTime(days, differenceInMinutes);
            const currentDayIndex = (new Date().getDay() + 6) % 7; // JavaScript возвращает 0 для воскресенья, поэтому делаем корректировку на -1
            highlightNextShow(days, currentDayIndex, currentTime);
            renderDaySchedule(days);
        </script>
    </div>
</body>
</html>
