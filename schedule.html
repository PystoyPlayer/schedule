<html>
<head>
    <title>График выхода серий (МСК)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
            line-height: 1.5;
            background-color: #181818;
            color: #d1d1d1;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: default;
        }
        div {
            max-width: 100%;
            max-width: 620px;
        }
        h1 {
            text-align: center;
            font-size: 36px;
            margin-bottom: 20px;
            color: #ffffff;
            user-select: all;
            -moz-user-select: all;
            -webkit-user-select: all;
            -ms-user-select: all;
        }
        h2 {
            font-size: 24px;
            margin-bottom: 5px;
            margin-top: 25px;
            color: #dddddd;
        }
        ul {
            list-style-type: none;
            padding-left: 0;
            margin-top: 0;
            margin-bottom: 7px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        li {
            margin-bottom: 5px;
            color: #dddddd;
        }
        .schedule-item {
            display: flex;
            align-items: baseline;
            cursor: default;
            transition: background-color 0.3s ease-in-out;
            margin-bottom: 2px;
            width: 100%;
            padding-left: 15px;
            box-sizing: border-box;
            border-radius: 5px;
        }
        .schedule-item .title {
            margin-left: 5px;
            padding-right: 15px;
            transition: opacity 0.5s ease-in-out;
        }
        .time {
            min-width: fit-content;
            padding: 2px 6px;
            border-radius: 6px;
            user-select: none;
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            background-color: rgba(170, 170, 170, 0.3);
            color: #dddddd;
            margin-right: 5px;
        }
        .empty-day {
            color: #ffffff;
        }
        .empty-item {
            pointer-events: none;
            opacity: 0.5;
        }
        .empty-item:hover {
            background-color: transparent;
        }
        .schedule-item:not(.empty-item):hover {
            background-color: rgba(170, 170, 170, 0.3);
            cursor: pointer;
        }
        .title:hover {
            background-color: transparent;
        }
        .time.highlighted {
            -webkit-box-shadow:inset 0px 0px 0px 1.5px rgba(0, 0, 255, 0.3);
            -moz-box-shadow:inset 0px 0px 0px 1.5px rgba(0, 0, 255, 0.3);
            box-shadow:inset 0px 0px 0px 1.5px rgba(0, 0, 255, 0.3);
        }
        .schedule-item .title {
            overflow: hidden;
            max-height: 3em;
            transition: max-height 0.5s ease-in-out;
        }
    </style>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet">
</head>
<body>
    <div>
        <h1>График выхода серий (МСК)</h1>
        <script>
            function copyText(element, textToCopy) {
                const clipboardText = textToCopy.trim();
                if (clipboardText) {
                    const textArea = document.createElement("textarea");
                    textArea.value = clipboardText;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    replaceTitleWithCopied(element);
                    console.log('Text copied to clipboard:', clipboardText);
                } else {
                    console.log('No text to copy.');
                }
            }

            function replaceTitleWithCopied(element) {
                const titleElement = element.querySelector('.title');
                const originalTitle = titleElement.textContent.trim();
                const animationDuration = 500;
                const originalHeight = titleElement.clientHeight + "px";
                titleElement.style.transition = `opacity ${animationDuration / 1000}s ease-in-out, max-height ${animationDuration / 1000}s ease-in-out`;
                titleElement.style.opacity = 0;
                titleElement.style.maxHeight = "0";

                setTimeout(() => {
                    titleElement.textContent = 'Скопировано';
                    titleElement.style.opacity = 1;
                    titleElement.style.maxHeight = originalHeight;

                    setTimeout(() => {
                        titleElement.style.transition = `opacity ${animationDuration / 1000}s ease-in-out, max-height ${animationDuration / 1000}s ease-in-out`;
                        titleElement.style.opacity = 0;
                        titleElement.style.maxHeight = "0";

                        setTimeout(() => {
                            titleElement.textContent = originalTitle;
                            titleElement.style.transition = `opacity ${animationDuration / 1000}s ease-in-out, max-height ${animationDuration / 1000}s ease-in-out`;
                            titleElement.style.opacity = 1;
                            titleElement.style.maxHeight = originalHeight;
                        }, animationDuration);
                    }, 1000);
                }, animationDuration);
            }

            const days = [
                {day: 'Понедельник', schedule: [
                    { time: '17:15', title: 'Миги и Дали' },
                    { time: '17:45', title: 'Рон Камонохаши: невменяемый детектив' },
                    { time: '19:15', title: 'Стесняшка' },
                    { time: '19:45', title: 'Я предпочитаю злодейку' },
                    { time: '20:15', title: 'Обычный мужчина средних лет и его журнал активности в VRMMO [4K]' }
                ]},
                { day: 'Вторник', schedule: [
                    { time: '17:15', title: 'Всемогущая магия святой 2' }
                ]},
                {day: 'Среда', schedule: [
                    { time: '16:15', title: 'Прибрал к рукам девушку, потерявшую жениха, и теперь учу её всяким плохим вещам' },
                    { time: '22:00', title: 'Восхождение в тени 2 [4K]' }
                ]},
                {day: 'Четверг', schedule: [
                    { time: '17:15', title: 'Моя дочь, отправившаяся в столицу, захотев стать авантюристом, достигла S-ранга' },
                    { time: '18:15', title: 'Невеста чародея 2. Часть 2' },
                    { time: '19:42', title: 'Низкоквалифицированный ниндзя' },
                    { time: '19:50', title: 'Мой телохранитель' },
                    { time: '20:20', title: 'Магическая битва 2' },
                    { time: '21:15', title: 'Бродяга Кэнсин' }
                ]},
                { day: 'Пятница', schedule: [
                    { time: '14:00', title: 'Восхождение героя щита 3' },
                    { time: '16:30', title: 'Убийца гоблинов 2' },
                    { time: '18:15', title: 'Фрирен, провожающая в последний путь' },
                    { time: '19:40', title: 'Аркнайтс: Зимнее уединение' },
                    { time: '20:15', title: 'Королевство руин' },
                    { time: '20:45', title: 'Мои девушки 2' }
                ]},
                { day: 'Суббота', schedule: [
                    { time: '12:15', title: 'Дайго из пожарной команды' },
                    { time: '16:15', title: 'Далёкий паладин 2' },
                    { time: '17:15', title: 'Семья шпиона 2' },
                    { time: '17:45', title: 'Мой новый босс глупый' },
                    { time: '18:45', title: 'Не ешь сырую свинину' },
                    { time: '19:15', title: 'История империи Тиамун' },
                    { time: '19:45', title: 'Наш дождливый протокол' },
                    { time: '20:15', title: 'Я выживу с помощью зелий!' }
                ]},
                { day: 'Воскресенье', schedule: [
                    { time: '12:15', title: 'Рубеж Шангри-Ла: Любитель игрошлака бросает вызов топ-игре' },
                    { time: '17:43', title: 'Обгон!' },
                    { time: '17:50', title: 'Семейная жизнь легкомысленной ведьмы' },
                    { time: '18:45', title: 'Ненасытный Берсерк' },
                    { time: '20:15', title: 'MF Призрак' }
                ]},
                { day: 'Без графика', schedule: [
                    { title: 'Мой счастливый брак (лето)' }
                ]}];
            const userTimeZoneOffset = new Date().getTimezoneOffset();
            const moscowTimeZoneOffset = -180; 
            const differenceInMinutes = userTimeZoneOffset - moscowTimeZoneOffset;

            days.forEach(day => {
                day.schedule.forEach(info => {
                    if (info.time) {
                        const [hours, minutes] = info.time.split(':');
                        let date = new Date();
                        date.setHours(+hours);
                        date.setMinutes(+minutes - differenceInMinutes);
                        info.time = date.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });
                        
                        if (differenceInMinutes > 0 && +hours * 60 + +minutes - differenceInMinutes < 0) {
                            days[(days.indexOf(day) + 1) % 7].schedule.push(info);
                            day.schedule = day.schedule.filter(item => item !== info);
                        } else if (differenceInMinutes < 0 && +hours * 60 + +minutes - differenceInMinutes >= 1440) {
                            days[(days.indexOf(day) - 1 + 7) % 7].schedule.push(info);
                            day.schedule = day.schedule.filter(item => item !== info);
                        }
                    }
                });
            });

            const timeZoneString = new Date().toLocaleTimeString('en-US', { timeZoneName: 'short' }).split(' ')[2];
            document.querySelector('h1').textContent = `График выхода серий (${timeZoneString})`;
            const currentDay = new Date().getDay();
            const currentTime = new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });
            let isNextShowFound = false;

            days.forEach((day, dayIndex) => {
                if (isNextShowFound) return;
                
                if ((currentDay - 1 === dayIndex) || (currentDay === 0 && dayIndex === 6)) {
                    for (let i = 0; i < day.schedule.length; i++) {
                        if (day.schedule[i].time > currentTime) {
                            day.schedule[i].highlighted = true;
                            isNextShowFound = true;
                            break;
                        }
                    }
                }
            });

            days.forEach(day => {
                const dayInfo = day.day;
                const schedule = day.schedule;
                if (schedule.length > 0) {
                    document.writeln(`<h2>${dayInfo}:</h2>`);
                    schedule.forEach(info => {
                        const timeCode = info.time;
                        const title = info.title;
                        const highlightTimeClass = info.highlighted ? 'highlighted' : '';
                        const listItem = timeCode
                            ? `<div class="schedule-item" onclick="copyText(this, '${timeCode} - ${title}')"><span class="time ${highlightTimeClass}">${timeCode}</span><span class="title">${title}</span></div>`
                            : `<div class="schedule-item" onclick="copyText(this, '${title}')"><span class="title">${title}</span></div>`;
                        document.writeln(`<ul>${listItem}</ul>`);
                    });
                } else {
                    document.writeln(`<h2 class="empty-day">${dayInfo}:</h2>`);
                    document.writeln('<ul class="schedule-item empty-item"><li class="empty-text">Пусто</li></ul>');
                }
            });
        </script>
    </div>
</body>
</html>
